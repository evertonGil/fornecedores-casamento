{"version":3,"sources":["../../app-es6/controllers/FormularioFornecedoresController.js"],"names":["FormularioFornecedoresController","$select","document","querySelector","bind","_mensagem","Bind","Mensagem","MensagemView","_conectaDB","FornecedoresService","_validacoes","Validacoes","fileDrag","dragAndDropView","DragAndDropView","update","filedrag","addEventListener","fileDragHover","anexaArquivos","cb","$","modal","on","focus","_fornecedor","Fornecedor","FormFornecedorView","cardapios","Cardapios","FormCardapioView","anexos","Anexos","ListaAnexosView","formUpload","_easyAutocomplete","_id","classList","add","remove","url","classe","options","getValue","element","console","log","nome","Captalize","string","list","match","enabled","easyAutocomplete","item","Array","prototype","slice","call","querySelectorAll","event","id","preventDefault","init","listaFornecedores","fornecedoresController","_listaDeFornecedores","lista","forEach","index","arr","cardapio","adiciona","anexo","setaValores","qtdMax","local","tipo","observacoes","link","Cardapio","ListaDeArquivos","target","files","dataTransfer","enviaAnexos","className","type","path","leitor","FileReader","iterador","i","readAsArrayBuffer","onload","promise","sobeAnexo","result","name","then","res","Anexo","statusFile","pathFile","statusDB","nModified","importa","novaMsg","catch","err","length","subDiretorio","deletaAnexo","exclui","fornecedor","iteraObjeto","propriedade","objeto","value","funcao","prop","hasOwnProperty","invalido","validaRegExp","_todosInputs","Object","defineProperty","enumerable","propValidas","includes","enviarNovoFornecedor","editaFornecedor","end","helperCadastraSeNaoTiver","listaTipo","adicionaTipo","listaLocal","adicionaLocal","trataErrorsInput","param","connection","tipoObj","toLowerCase","Existe","some","promiseAdiciona","erros","JSON","parse","errors","input"],"mappings":"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","file":"FormularioFornecedoresController.js","sourcesContent":["class FormularioFornecedoresController{\r\n\tconstructor(){\r\n\t\t\r\n\t\tlet $select = document.querySelector.bind(document);\r\n\r\n\t\tthis._mensagem =  new Bind(\r\n\t\t\tnew Mensagem(),\r\n\t\t\tnew MensagemView($select(\"#mensagemView\")),\r\n\t\t\t'novaMsg');\r\n\r\n\t\tthis._conectaDB = new FornecedoresService();\r\n\r\n\t\tthis._validacoes = new Validacoes();\r\n\t\t\r\n\r\n\t\tlet fileDrag = document.querySelector(\"#filedrag\");\r\n\r\n\t\tthis.dragAndDropView = new DragAndDropView($select(\"#filedrag\"));\r\n\t\tthis.dragAndDropView.update(\"finalizado\");\r\n\r\n\t\tfiledrag.addEventListener(\"dragover\", this.fileDragHover, false);\r\n\t\tfiledrag.addEventListener(\"dragenter\", this.fileDragHover, false);\r\n\t\tfiledrag.addEventListener(\"dragstart\", this.fileDragHover, false);\r\n\t\tfiledrag.addEventListener(\"dragend\", this.fileDragHover, false);\r\n\t\tfiledrag.addEventListener(\"dragleave\", this.fileDragHover, false);\r\n\t\tfiledrag.addEventListener(\"drop\", this.anexaArquivos.bind(this), false);\r\n\t}\r\n\r\n\tinit(cb){\r\n\t\t\r\n\t\tlet $select = document.querySelector.bind(document);\r\n\r\n\t\t$('.modal').modal();\r\n\r\n\t\t$('.modal').on('shown.bs.modal', function () {\r\n\t\t\t$('#nome').focus();\r\n\t\t  });\r\n\r\n\t\tthis._fornecedor = new Bind(\r\n\t\t\tnew Fornecedor(),\r\n\t\t\tnew FormFornecedorView($select(\"#fornecedorView\")),\r\n\t\t\t'id', 'limpa', 'setaValores' );\r\n\r\n\t\tthis._fornecedor.cardapios =  new Bind(\r\n\t\t\tnew Cardapios(),\r\n\t\t\tnew FormCardapioView(document.querySelector(\"#cardapiosView\")),\r\n\t\t\t'adiciona', 'exclui', 'limpa');\r\n\r\n\t\tthis._fornecedor.anexos =  new Bind(\r\n\t\t\t\tnew Anexos(),\r\n\t\t\t\tnew ListaAnexosView(document.querySelector(\"#listaAnexosView\")),\r\n\t\t\t\t'adiciona', 'exclui', 'limpa');\r\n\r\n\t\tlet formUpload = document.querySelector(\".arquivos-anexos\");\r\n\r\n\t\t\r\n\t\t\r\n\r\n\t\t//console.log('init.fornecedor.cardapios.lista', this._fornecedor.cardapios.lista);\r\n\t\tthis._easyAutocomplete(\"/v1/tipofornecedor\", \"#fornecedorView #tipo\");\r\n\t\tthis._easyAutocomplete(\"/v1/localfornecedor\", \"#fornecedorView #local\");\r\n\t\t\r\n\t\t//console.log($select('#fornecedorView #nome'));\r\n\t\tif(cb){\r\n\t\t\tcb();\r\n\t\t\t\t\t\t\r\n\t\t}\r\n\r\n\r\n\t\t///console.log(\"id\", this._fornecedor);\r\n\t\tif(this._fornecedor._id){\r\n\t\t\t\r\n\t\t\tformUpload.classList.add(\"aberto\");\t\r\n\t\t\t\r\n\t\t}\r\n\t\telse{\r\n\t\t\tformUpload.classList.remove(\"aberto\");\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\tend(){\r\n\r\n\t\t$('.modal').modal(\"hide\");\r\n\t\tthis._fornecedor = {};\r\n\t\t//console.log('end.fornecedor.cardapio', this._fornecedor.cardapios);\r\n\t}\r\n\r\n\t_easyAutocomplete(url, classe){\r\n\t\tvar options = {\r\n\t\t\turl: url,\r\n\t\t\tgetValue: function(element) {\r\n\t\t\t\tconsole.log(this, element.nome);\r\n\t\t\t\treturn Captalize.string(element.nome);\r\n\t\t\t},\r\n\t\t\tlist: {\r\n\t\t\t\tmatch: {\r\n\t\t\t\t\tenabled: true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t$(classe).easyAutocomplete(options);\r\n\t}\r\n\r\n\t_todosInputs(item){ \r\n\t\treturn Array.prototype.slice.call(document.querySelectorAll(\".formulario_fornecedor input\"));\r\n\t}\r\n\r\n\teditaFornecedor(event, id){\r\n\t\tevent.preventDefault();\r\n\r\n\t\tthis.init(() =>{\r\n\t\t\t\r\n\t\t\tlet listaFornecedores = fornecedoresController._listaDeFornecedores.lista;\r\n\r\n\t\t\tlistaFornecedores.forEach((item, index, arr) =>{\r\n\t\t\t\t\r\n\t\t\t\tif(item._id == id){\r\n\t\t\t\t\t//console.log(item);\r\n\t\t\t\t\titem.cardapios.lista.forEach((cardapio, index) =>{\r\n\t\t\t\t\t\tthis._fornecedor.cardapios.adiciona(cardapio);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\titem.anexos.lista.forEach((anexo, index) =>{\r\n\t\t\t\t\t\tthis._fornecedor.anexos.adiciona(anexo);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tthis._fornecedor.setaValores(item.id, item.nome, item.qtdMax, item.local, item.tipo, item.observacoes, this._fornecedor.cardapios, item.link, this._fornecedor.anexos);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tthis._easyAutocomplete(\"/v1/tipofornecedor\", \"#fornecedorView #tipo\");\r\n\t\t\tthis._easyAutocomplete(\"/v1/localfornecedor\", \"#fornecedorView #local\");\r\n\t\t});\r\n\t}\r\n\r\n\tadicionaCardapio(event){\r\n\t\tevent.preventDefault();\r\n\t\tlet cardapio = new Cardapio();\r\n\t\tthis._fornecedor.cardapios.adiciona(cardapio);\r\n\t}\r\n\r\n\tanexaArquivos(event){\r\n\t\tthis.fileDragHover(event);\r\n\r\n\t\tlet ListaDeArquivos = event.target.files || event.dataTransfer.files;\r\n\t\t//console.log(\"ListaDeArquivos: \", ListaDeArquivos);\r\n\r\n\t\tthis.enviaAnexos.call(this, ListaDeArquivos);\t\r\n\t}\r\n\r\n\tfileDragHover(event) {\r\n\t\tevent.preventDefault();\r\n\t\t//console.log(event);\r\n\r\n\t\tif(event.target.id == \"filedrag\"){\r\n\t\t\tevent.target.className = (event.type == \"dragover\" ? \"hover\" : \"\");\r\n\t\t}\r\n\t\tif(event.path[1].id == \"filedrag\"){\r\n\t\t\tevent.path[1].className = (event.type == \"dragover\" ? \"hover\" : \"\");\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\tenviaAnexos(files){\r\n\t\t//console.log(\"1 this:\", this,\"files:\", files);\r\n\t\tthis.dragAndDropView.update(\"emProgresso\");\r\n\t\tfor(var i = 0; i < files.length; i++){\r\n\t\t\tlet leitor = new FileReader();\r\n\t\t\tlet iterador = i;\r\n\t\t\tleitor.readAsArrayBuffer(files[i]);\r\n\t\t\t//console.log(\"2 this:\", this,\"files:\", files);\r\n\t\t\tleitor.onload = progressEvent =>{\r\n\t\t\t\t//console.log(\"3 this:\", this,\"files:\", files);\r\n\t\t\t\tlet promise = this._conectaDB.sobeAnexo(leitor.result, this._fornecedor.id, files[iterador].name, this._fornecedor.id);\r\n\t\t\t\tpromise\r\n\t\t\t\t.then(res =>{\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\tlet anexo = new Anexo(res.statusFile.pathFile);\r\n\t\t\t\t\tif(res.statusDB.nModified > 0){\r\n\t\t\t\t\t\tthis._fornecedor.anexos.adiciona(anexo);\r\n\t\t\t\t\t\tfornecedoresController.importa();\r\n\t\t\t\t\t\tthis._mensagem.novaMsg('Anexo adicionado com sucesso.', \"success\", 3400);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis._mensagem.novaMsg('Anexo Atualizado com sucesso.', \"success\", 3400);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.dragAndDropView.update(\"finalizado\");\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t})\r\n\t\t\t\t.catch(err =>{\r\n\t\t\t\t\tthis._mensagem.novaMsg('Não foi possível adicionar anexo.', \"danger\", 4400);\r\n\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t})\r\n\t\t\t};\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t}\r\n\r\n\tremoveAnexo(event, index){\t\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tlet anexo = this._fornecedor.anexos.lista[index];\r\n\r\n\t\tconsole.log(\"Arquivo:\", anexo.nome,\"Sub-diretorio:\", anexo.subDiretorio, \"_id:\", this._fornecedor.id);\r\n\t\r\n\r\n\t\tlet promise = this._conectaDB.deletaAnexo(anexo.nome, anexo.subDiretorio, this._fornecedor.id);\r\n\t\tpromise\r\n\t\t.then(res =>{\r\n\t\t\tconsole.log(\"res:\", res);\r\n\t\t\tthis._fornecedor.anexos.exclui(index);\r\n\t\t})\r\n\t\t.catch(err => {\r\n\t\t\tthis._mensagem.novaMsg('Não foi possível adicionar anexo.', \"danger\", 4400);\r\n\t\t\tconsole.log(err);\r\n\t\t});\r\n\r\n\t\tfornecedoresController.importa();\r\n\r\n\t}\r\n\r\n\tremoveCardapio(event, index){\r\n\t\tevent.preventDefault();\r\n\t\tthis._fornecedor.cardapios.exclui(index);\r\n\t}\r\n\r\n\tsetValPropFornecedor(event){\r\n\r\n\t\tlet fornecedor = this._fornecedor;\r\n\t\tthis.iteraObjeto(fornecedor, (propriedade, objeto) =>{\r\n\t\t\tif(propriedade == `${event.target.id}`) \r\n\t\t\t\tobjeto[propriedade] = event.target.value\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tsetValPropCardapio(event, index){\r\n\t\tthis._fornecedor.cardapios.lista.forEach((cardapio, i, arr)=>{\r\n\t\t\tif(i == index){\r\n\t\t\t\tthis.iteraObjeto(cardapio, (propriedade, objeto) =>{\r\n\t\t\t\t\tif(propriedade == `${event.target.id}`) \r\n\t\t\t\t\t\tobjeto[propriedade] = event.target.value;\r\n\t\t\t\t});\t\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\titeraObjeto(objeto, funcao){\r\n\t\tvar i = 0;\r\n\t\tfor (var prop in objeto) {\r\n\t\t\tif (objeto.hasOwnProperty(prop)) {\r\n\t\t\t\tfuncao(prop, objeto, i);\r\n\t\t\t\ti++\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tadiciona(event){\r\n\r\n\t\tevent.preventDefault();\r\n\t\t\r\n\t\tlet $select = document.querySelector.bind(document);\r\n\t\tlet invalido = this._validacoes.validaRegExp(this._todosInputs());\r\n\r\n\t\tconsole.log('invalido: ', invalido);\r\n\t\tif(invalido)\r\n\t\t{\r\n\t\t\tthis._mensagem.novaMsg('Por favor preencha os campos obrigatórios', \"danger\", 2400);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t//criando o object para ser enviado\r\n\t\tlet fornecedor = this._fornecedor;\r\n\t\t\t\t\r\n\t\tObject.defineProperty(fornecedor, '_id', {\r\n\t\t\tenumerable: false\r\n\t\t});\r\n\r\n\t\tfornecedor.cardapios.lista.forEach((cardapio, i, arr) =>{\r\n\t\t\t\r\n\t\t\tlet propValidas = [ 'nome', 'valorPorPessoa', 'aluguel', 'dj', 'decoracao'];\r\n\r\n\t\t\tfor(var prop in cardapio){\r\n\t\t\t\tif( !propValidas.includes(prop)) Object.defineProperty(cardapio, prop, {enumerable: false})\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn cardapio;\r\n\t\t});\r\n\t\tfornecedor.anexos.lista.forEach((anexo, i, arr) =>{\r\n\t\t\t\r\n\t\t\tlet propValidas = [ 'link'];\r\n\r\n\t\t\tfor(var prop in anexo){\r\n\t\t\t\tif( !propValidas.includes(prop)) Object.defineProperty(anexo, prop, {enumerable: false})\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn anexo;\r\n\t\t});\r\n\r\n\t\tfornecedor.cardapios = fornecedor.cardapios.lista;\r\n\t\tfornecedor.anexos = fornecedor.anexos.lista;\r\n\r\n\t\tlet promise;\r\n\r\n\t\tif(!fornecedor.id){\tpromise = this._conectaDB.enviarNovoFornecedor(fornecedor); }\r\n\t\telse{ promise = this._conectaDB.editaFornecedor(fornecedor.id, fornecedor); }\r\n\t\t\r\n\t\tpromise\r\n\t\t.then(res => {\r\n\t\t\tthis._mensagem.novaMsg('Forncedor incluido com sucesso', \"success\", 2400);\r\n\t\t\tthis.end();\r\n\t\t\tfornecedoresController.importa();\r\n\t\t\tconsole.log(res);\r\n\t\t})\r\n\t\t.then(() => {\r\n\t\t\tthis.helperCadastraSeNaoTiver(this._conectaDB.listaTipo(), \r\n\t\t\t\tfornecedor.tipo, \r\n\t\t\t\tthis._conectaDB,\r\n\t\t\t\tthis._conectaDB.adicionaTipo.bind(this._conectaDB));\r\n\t\t})\r\n\t\t.then(() => {\r\n\r\n\t\t\tthis.helperCadastraSeNaoTiver(this._conectaDB.listaLocal(), \r\n\t\t\t\tfornecedor.local, \r\n\t\t\t\tthis._conectaDB,\r\n\t\t\t\tthis._conectaDB.adicionaLocal.bind(this._conectaDB));\r\n\t\t})\r\n\t\t.catch(err => {\r\n\t\t\tconsole.log(err);\r\n\t\t\ttrataErrorsInput(err);\r\n\t\t\tthis._mensagem.novaMsg('Não foi possível cadastrar o fornecedor.', \"danger\", 2400);\r\n\t\t});\r\n\r\n\r\n\t}\r\n\r\n\thelperCadastraSeNaoTiver(promise, param, connection, adiciona){\r\n\r\n\t\tlet tipoObj = {nome: param.toLowerCase()};\r\n\r\n\t\tpromise\r\n\t\t.then(res =>{\r\n\t\t\tif(res.length)\r\n\t\t\t{\r\n\t\t\t\tvar Existe = res.some((item, i, arr) =>{ return item.nome.toLowerCase() == param.toLowerCase(); });\r\n\r\n\t\t\t\tif(!Existe){\r\n\r\n\t\t\t\t\tlet promiseAdiciona = adiciona(tipoObj);\r\n\t\t\t\t\tpromiseAdiciona.then(res => console.log(res)).catch(err => console.log(err));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t\r\n\t\t\t\tlet promiseAdiciona = adiciona(tipoObj);\r\n\t\t\t\tpromiseAdiciona.then(res => console.log(res)).catch(err => console.log(err));\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(err =>{\r\n\t\t\tconsole.log(err);\r\n\t\t});\r\n\t}\r\n\r\n\ttrataErrorsInput(err){\r\n\t\tvar erros = JSON.parse(err).errors;\r\n\r\n\t\tthis.iteraObjeto(erros, (prop, objeto, index) => {\r\n\t\t\tthis._todosInputs().forEach(input => {\r\n\t\t\t\tif(input.id == prop){\r\n\t\t\t\t\tinput.classList.add(\"is-invalid\");\r\n\t\t\t\t\t input.focus()\r\n\t\t\t\t}\r\n\t\t\t\telse{ \r\n\t\t\t\t\tinput.classList.remove(\"is-invalid\");\r\n\t\t\t\t}\r\n\t\t\t})\t\t\t\t\r\n\t\t});\r\n\t}\r\n}"]}